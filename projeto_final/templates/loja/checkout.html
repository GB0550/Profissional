<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - JHG CELL</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
        }

        html, body {
            height: 100vh !important;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%) !important;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif !important;
            color: #ffffff !important;
            line-height: 1.6 !important;
            overflow-x: hidden !important;
        }

        .container { 
            max-width: 900px !important;
            margin: 0 auto !important;
            padding: 2rem !important;
            background: rgba(255, 255, 255, 0.05) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 20px !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4) !important;
            margin: 4rem auto !important;
        }

        h1, h2, h3 {
            color: #ffffff !important;
            font-weight: 700 !important;
            letter-spacing: -0.02em !important;
        }

        h1 {
            font-size: 2.5rem !important;
            background: linear-gradient(135deg, #00d4ff, #ff00d4) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            margin-bottom: 2rem !important;
            text-align: center !important;
        }

        select {
            width: 100% !important;
            padding: 1.25rem 1.5rem !important;
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px !important;
            background: rgba(30, 30, 30, 0.95) !important;
            color: #ffffff !important;
            font-size: 1rem !important;
            font-family: inherit !important;
            backdrop-filter: blur(10px) !important;
            transition: all 0.3s ease !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 20 20'%3e%3cpath d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right 1rem center !important;
            background-size: 1.2em !important;
        }

        select option {
            background: #1e1e1e !important;
            color: #ffffff !important;
            padding: 1rem !important;
        }

        select:focus {
            outline: none !important;
            border-color: #00d4ff !important;
            background: rgba(30, 30, 30, 1) !important;
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.2) !important;
            transform: translateY(-2px) !important;
        }

        .btn:disabled {
            opacity: 0.6 !important;
            cursor: not-allowed !important;
            background: rgba(255,255,255,0.1) !important;
        }

        .top-buttons {
            display: flex !important;
            gap: 1rem !important;
            justify-content: center !important;
            margin-bottom: 3rem !important;
        }

        table { 
            width: 100% !important;
            border-collapse: collapse !important;
            margin-bottom: 2rem !important;
            background: rgba(255, 255, 255, 0.05) !important;
            border-radius: 12px !important;
            overflow: hidden !important;
            backdrop-filter: blur(10px) !important;
        }

        th, td { 
            padding: 1.25rem !important;
            text-align: left !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        th { 
            background: rgba(0, 212, 255, 0.2) !important;
            font-weight: 600 !important;
            color: #00d4ff !important;
            text-transform: uppercase !important;
            font-size: 0.85rem !important;
            letter-spacing: 1px !important;
        }

        .total {
            font-size: 2rem !important;
            font-weight: 800 !important;
            color: #00d4ff !important;
            text-align: right !important;
            margin: 2rem 0 !important;
            background: linear-gradient(135deg, #00d4ff, #ff00d4) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        label {
            display: block !important;
            margin-top: 1.5rem !important;
            margin-bottom: 0.5rem !important;
            font-weight: 600 !important;
            color: #ffffff !important;
            font-size: 0.95rem !important;
            letter-spacing: 0.5px !important;
        }

        .form-group {
            margin-bottom: 2rem !important;
        }

        input, textarea {
            width: 100% !important;
            padding: 1.25rem 1.5rem !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 12px !important;
            background: rgba(255, 255, 255, 0.1) !important;
            color: #ffffff !important;
            font-size: 1rem !important;
            font-family: inherit !important;
            backdrop-filter: blur(10px) !important;
            transition: all 0.3s ease !important;
        }

        input[type="number"], input[type="tel"] {
            font-family: 'Courier New', monospace !important;
            letter-spacing: 1px !important;
        }

        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        input:focus, textarea:focus {
            outline: none !important;
            border-color: #00d4ff !important;
            background: rgba(255, 255, 255, 0.15) !important;
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.2) !important;
            transform: translateY(-2px) !important;
        }

        .payment-section {
            background: rgba(255, 0, 212, 0.15) !important;
            border: 1px solid rgba(255, 0, 212, 0.3) !important;
            border-radius: 16px !important;
            padding: 2rem !important;
            margin: 2rem 0 !important;
        }

        .payment-option {
            display: flex !important;
            align-items: center !important;
            gap: 1rem !important;
            padding: 1.25rem !important;
            margin: 0.75rem 0 !important;
            border-radius: 12px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            background: rgba(255, 255, 255, 0.05) !important;
            border: 2px solid transparent !important;
        }

        .payment-option:hover {
            background: rgba(0, 212, 255, 0.15) !important;
            border-color: rgba(0, 212, 255, 0.3) !important;
        }

        .payment-content {
            flex: 1 !important;
            display: flex !important;
            align-items: center !important;
            gap: 1rem !important;
        }

        .payment-fields {
            display: none !important;
            margin-top: 1.5rem !important;
            padding: 1.5rem !important;
            background: rgba(0, 212, 255, 0.1) !important;
            border-radius: 12px !important;
            border: 1px solid rgba(0, 212, 255, 0.3) !important;
        }

        .payment-fields.active {
            display: block !important;
            animation: slideDown 0.3s ease !important;
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }

        .card-row {
            display: grid !important;
            grid-template-columns: 2fr 1fr 1fr !important;
            gap: 1rem !important;
            margin-bottom: 1rem !important;
        }

        .pix-code {
            text-align: center !important;
            padding: 2rem !important;
            background: rgba(34, 197, 94, 0.2) !important;
            border-radius: 12px !important;
            border: 1px solid #22c55e !important;
        }

        .pix-qr {
            width: 200px !important;
            height: 200px !important;
            background: #22c55e !important;
            border-radius: 12px !important;
            margin: 1rem auto !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            color: white !important;
            font-size: 3rem !important;
        }

        .btn { 
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.5rem !important;
            padding: 1.25rem 2.5rem !important;
            background: linear-gradient(135deg, #000000 0%, #333333 100%) !important;
            color: #ffffff !important;
            border: 2px solid #ffffff !important;
            border-radius: 50px !important;
            font-weight: 600 !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            font-size: 1rem !important;
            text-decoration: none !important;
            position: relative !important;
            overflow: hidden !important;
            margin: 0.5rem !important;
        }

        .btn::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: -100% !important;
            width: 100% !important;
            height: 100% !important;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent) !important;
            transition: left 0.5s !important;
        }

        .btn:hover::before {
            left: 100% !important;
        }

        .btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%) !important;
            color: #000000 !important;
            transform: translateY(-3px) !important;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4) !important;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%) !important;
            color: #000000 !important;
            border-color: #000000 !important;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #000000 0%, #333333 100%) !important;
            color: #ffffff !important;
            border-color: #ffffff !important;
        }

        .buttons-container {
            display: flex !important;
            justify-content: center !important;
            gap: 1rem !important;
            margin-top: 3rem !important;
        }

        @media (max-width: 768px) {
            .container {
                margin: 2rem 1rem !important;
                padding: 1.5rem !important;
            }
            
            h1 {
                font-size: 2rem !important;
            }
            
            .top-buttons, .buttons-container {
                flex-direction: column !important;
                align-items: center !important;
            }
            
            table {
                font-size: 0.9rem !important;
            }
            
            th, td {
                padding: 0.75rem !important;
            }
            
            .card-row {
                grid-template-columns: 1fr !important;
                gap: 0.75rem !important;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1><i class="bi bi-cart-check"></i> Checkout</h1>
    
    <div class="top-buttons">
        <a href="{% url 'home' %}" class="btn btn-secondary">
            <i class="bi bi-house"></i> Voltar ao In√≠cio
        </a>
        <a href="{% url 'carrinho' %}" class="btn btn-secondary">
            <i class="bi bi-cart"></i> Voltar ao Carrinho
        </a>
    </div>

    {% if carrinho|length == 0 %}
        <div style="text-align: center; padding: 3rem 0;">
            <i class="bi bi-cart-x" style="font-size: 4rem; color: rgba(255,255,255,0.3); margin-bottom: 1rem;"></i>
            <h2 style="color: rgba(255,255,255,0.7);">Seu carrinho est√° vazio</h2>
            <a href="{% url 'home' %}" class="btn">Ir para a Loja</a>
        </div>
    {% else %}
        <h2>Resumo do Pedido</h2>
        <table>
            <tr>
                <th>Produto</th>
                <th>Qtd</th>
                <th>Pre√ßo Unit.</th>
                <th>Subtotal</th>
            </tr>
            {% for item in carrinho %}
            <tr>
                <td style="font-weight: 500;">{{ item.nome }}</td>
                <td style="color: #00d4ff;">{{ item.quantidade }}</td>
                <td>R$ {{ item.preco }}</td>
                <td style="font-weight: 600; color: #00d4ff;">R$ {{ item.subtotal }}</td>
            </tr>
            {% endfor %}
        </table>
        <div class="total">
            Total: R$ {{ carrinho.total }}
        </div>

        <h2>Dados para Entrega</h2>
        
        <!-- ‚úÖ FORM CORRIGIDO - SEM ACTION (view resolve automaticamente) -->
        <form method="post" id="checkoutForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label><i class="bi bi-person"></i> Nome Completo:</label>
                <input type="text" name="nome" placeholder="Digite seu nome completo" required>
            </div>

            <div class="form-group">
                <label><i class="bi bi-envelope"></i> Email:</label>
                <input type="email" name="email" placeholder="seu@email.com" required>
            </div>

            <div class="form-group">
                <label><i class="bi bi-credit-card"></i> CPF:</label>
                <input type="text" name="cpf" placeholder="000.000.000-00" maxlength="14" required>
            </div>

            <div class="form-group">
                <label><i class="bi bi-geo-alt"></i> Endere√ßo Completo:</label>
                <textarea name="endereco" rows="3" placeholder="Rua, n√∫mero, bairro, cidade, CEP, estado..." required></textarea>
            </div>

            <div class="payment-section">
                <h3 style="color: #ff00d4; margin-bottom: 1.5rem;">
                    <i class="bi bi-credit-card-2-front"></i> Forma de Pagamento
                </h3>
                
                <div>
                    <label class="payment-option">
                        <input type="radio" name="pagamento" value="cartao" id="cartao">
                        <div class="payment-content">
                            <i class="bi bi-credit-card" style="font-size: 1.5rem; color: #00d4ff;"></i>
                            <div>
                                <strong>Cart√£o de Cr√©dito/D√©bito</strong><br>
                                <small>Visa, Mastercard, Elo</small>
                            </div>
                        </div>
                    </label>

                    <div class="payment-fields" id="cartao-fields">
                        <div class="card-row">
                            <div>
                                <label>N√∫mero do Cart√£o:</label>
                                <input type="tel" name="cartao_numero" autocomplete="cc-number" inputmode="numeric" placeholder="0000 0000 0000 0000" maxlength="19">
                            </div>
                            <div>
                                <label>Validade:</label>
                                <input type="text" name="cartao_validade" autocomplete="cc-exp" placeholder="MM/AA" maxlength="5">
                            </div>
                            <div>
                                <label>CVV:</label>
                                <input type="tel" name="cartao_cvv" autocomplete="cc-csc" inputmode="numeric" maxlength="4" placeholder="123">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Nome no Cart√£o:</label>
                            <input type="text" name="cartao_nome" autocomplete="cc-name" placeholder="Nome completo como no cart√£o">
                        </div>
                    </div>

                    <label class="payment-option">
                        <input type="radio" name="pagamento" value="boleto" id="boleto">
                        <div class="payment-content">
                            <i class="bi bi-receipt" style="font-size: 1.5rem; color: #22c55e;"></i>
                            <div>
                                <strong>Boleto Banc√°rio</strong><br>
                                <small>Pague em qualquer banco at√© o vencimento</small>
                            </div>
                        </div>
                    </label>

                    <div class="payment-fields" id="boleto-fields">
                        <div class="form-group">
                            <label>Banco:</label>
                            <select name="boleto_banco">
                                <option value="">Selecione o banco</option>
                                <option value="bb">Banco do Brasil</option>
                                <option value="caixa">Caixa Econ√¥mica</option>
                                <option value="bradesco">Bradesco</option>
                                <option value="itau">Ita√∫</option>
                                <option value="santander">Santander</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Data de Vencimento Preferida:</label>
                            <input type="date" name="boleto_vencimento">
                        </div>
                    </div>

                    <label class="payment-option">
                        <input type="radio" name="pagamento" value="pix" id="pix">
                        <div class="payment-content">
                            <i class="bi bi-qr-code" style="font-size: 1.5rem; color: #22c55e;"></i>
                            <div>
                                <strong>PIX (√† vista)</strong><br>
                                <small>Pagamento instant√¢neo - 10% OFF</small>
                            </div>
                        </div>
                    </label>

                    <div class="payment-fields" id="pix-fields">
                        <div class="pix-code">
                            <div class="pix-qr">üì± PIX</div>
                            <p><strong>PIX ser√° gerado ap√≥s confirma√ß√£o do pedido</strong></p>
                            <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                                Copie o c√≥digo PIX ou escaneie o QR Code<br>
                                Pagamento instant√¢neo com desconto de 10%
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="buttons-container">
                <a href="{% url 'carrinho' %}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Editar Carrinho
                </a>
                <button type="submit" class="btn" id="submitBtn" disabled>
                    <i class="bi bi-exclamation-triangle"></i> Selecione uma forma de pagamento
                </button>
            </div>
        </form>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const radios = document.querySelectorAll('input[name="pagamento"]');
    const fields = {
        cartao: document.getElementById('cartao-fields'),
        boleto: document.getElementById('boleto-fields'),
        pix: document.getElementById('pix-fields')
    };

    radios.forEach(radio => {
        radio.addEventListener('change', function() {
            Object.values(fields).forEach(field => field.classList.remove('active'));
            if (this.value in fields) {
                fields[this.value].classList.add('active');
            }
            updateSubmitButton();
        });
    });

    const numeroCartao = document.querySelector('input[name="cartao_numero"]');
    if (numeroCartao) {
        numeroCartao.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
            e.target.value = value;
        });
    }

    const validade = document.querySelector('input[name="cartao_validade"]');
    if (validade) {
        validade.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0,2) + '/' + value.substring(2,4);
            }
            e.target.value = value;
        });
    }

    function updateSubmitButton() {
        const selected = document.querySelector('input[name="pagamento"]:checked');
        const submitBtn = document.getElementById('submitBtn');
        if (selected) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="bi bi-check-circle"></i> Confirmar Compra';
        } else {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="bi bi-exclamation-triangle"></i> Selecione uma forma de pagamento';
        }
    }

    updateSubmitButton();
});
</script>
</body>
</html>
